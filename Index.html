<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>String Art Circle</title>
<style>
    body { 
        display: flex; 
        justify-content: center; 
        align-items: center; 
        height: 100vh; 
        font-family: Arial, sans-serif; 
        margin: 0; 
        overflow: hidden;
    }
    #controls { 
        margin-left: 15px; 
        text-align: left;
        width: 150px;
    }

    canvas { 
        background-color: #fff; 
        border: 1px solid #000; 
    }

    button { 
        font-size: 14px; 
        padding: 6px 10px; 
        margin: 5px 0; 
        border: none; 
        color: white; 
        cursor: pointer; 
        width: 100%;
        border-radius: 6px;
    }

    #nextBtn { background-color: green; }
    #prevBtn { background-color: red; }
    #playPauseBtn { background-color: gray; }
    #previewBtn { background-color: blue; }

    #counter, #moveDetails { 
        font-size: 14px; 
        margin-bottom: 8px;
    }
</style>
</head>
<body>

    <canvas id="circleCanvas" width="650" height="650"></canvas>

    <div id="controls">
        <div id="counter">Step 1 of 4000</div>
        <div id="moveDetails">0 → 0</div>

        <button id="prevBtn" onclick="prevStep()">Previous</button>
        <button id="nextBtn" onclick="nextStep()">Next</button>
        <button id="playPauseBtn">Play</button>
        <button id="previewBtn" onclick="previewAll()">Preview</button>
    </div>

    <script src="numbers.js"></script>

    <script>
        const canvas = document.getElementById('circleCanvas');
        const ctx = canvas.getContext('2d');
        const width = canvas.width;
        const height = canvas.height;
        const centerX = width / 2;
        const centerY = height / 2;
        const radius = 310;
        const totalPins = 288;

        let currentIndex = 0;
        let isPlaying = false;
        let intervalId = null;
        const stepDelay = 10;

        const counter = document.getElementById('counter');
        const moveDetails = document.getElementById('moveDetails');
        const playPauseBtn = document.getElementById('playPauseBtn');

        // Corrected pin positions: flipped X-axis to fix mirrored image
        const pins = [];
        for (let i = 0; i < totalPins; i++) {
            const angle = (i / totalPins) * 2 * Math.PI + Math.PI;
            pins.push({
                x: centerX - radius * Math.cos(angle), // flipped X-axis
                y: centerY - radius * Math.sin(angle)  // keep Y inverted for upright image
            });
        }

        function drawPins() {
            ctx.clearRect(0, 0, width, height);
            ctx.fillStyle = 'black';
            for (let i = 0; i < pins.length; i++) {
                ctx.beginPath();
                ctx.arc(pins[i].x, pins[i].y, 1.5, 0, 2 * Math.PI);
                ctx.fill();
            }
        }

        function drawLines(limit) {
            ctx.lineWidth = 0.2;

            // Draw all previous lines in black
            ctx.strokeStyle = 'black';
            for (let i = 1; i < limit; i++) {
                let startPin = numbers[i - 1] % totalPins;
                let endPin = numbers[i] % totalPins;

                ctx.beginPath();
                ctx.moveTo(pins[startPin].x, pins[startPin].y);
                ctx.lineTo(pins[endPin].x, pins[endPin].y);
                ctx.stroke();
            }

            // Draw current step in red
            if (limit > 0 && limit < numbers.length) {
                let startPin = numbers[limit - 1] % totalPins;
                let endPin = numbers[limit] % totalPins;

                ctx.strokeStyle = 'red';
                ctx.beginPath();
                ctx.moveTo(pins[startPin].x, pins[startPin].y);
                ctx.lineTo(pins[endPin].x, pins[endPin].y);
                ctx.stroke();
            }
        }

        function updateDisplay() {
            drawPins();
            drawLines(currentIndex);

            counter.textContent = `Step ${currentIndex + 1} of ${numbers.length}`;

            let startPin = numbers[currentIndex] % totalPins;
            let nextPin = (currentIndex + 1 < numbers.length) ?
                          numbers[currentIndex + 1] % totalPins : startPin;

            moveDetails.textContent = `${startPin} → ${nextPin}`;
        }

        function nextStep() {
            if (currentIndex < numbers.length - 1) {
                currentIndex++;
            } else pause();
            updateDisplay();
        }

        function prevStep() {
            if (currentIndex > 0) currentIndex--;
            updateDisplay();
        }

        function play() {
            isPlaying = true;
            playPauseBtn.textContent = 'Pause';
            intervalId = setInterval(nextStep, stepDelay);
        }

        function pause() {
            isPlaying = false;
            playPauseBtn.textContent = 'Play';
            clearInterval(intervalId);
        }

        playPauseBtn.addEventListener('click', () => {
            if (isPlaying) pause();
            else play();
        });

        function previewAll() {
            pause();
            currentIndex = numbers.length - 1;
            updateDisplay();
        }

        updateDisplay();
    </script>

</body>
</html>
